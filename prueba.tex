\unprotect

\newcount\daystt
\newcount\monstt
\newcount\yerstt

\newcount\dayend
\newcount\monend
\newcount\yerend

\newcount\daydiff
\newcount\mondiff
\newcount\yerdiff

\unexpanded\def\setupstt
  {\dosingleargument\setup_stt_aux}

\def\setup_stt_aux[#1]%
  {\letdummyparameter\c!d\normalday
   \letdummyparameter\c!m\normalmonth
   \letdummyparameter\c!y\normalyear
   \getdummyparameters[#1]%
   \daystt\directdummyparameter\c!d\relax
   \monstt\directdummyparameter\c!m\relax
   \yerstt\directdummyparameter\c!y\relax}

\unexpanded\def\setupend
  {\dosingleargument\setup_end_aux}

\def\setup_end_aux[#1]%
  {\letdummyparameter\c!d\normalday
   \letdummyparameter\c!m\normalmonth
   \letdummyparameter\c!y\normalyear
   \getdummyparameters[#1]%
   \dayend\directdummyparameter\c!d\relax
   \monend\directdummyparameter\c!m\relax
   \yerend\directdummyparameter\c!y\relax}

\unexpanded\def\calculate{
\yerdiff\yerend\relax
\advance\yerdiff-\yerstt\relax
\advance\yerdiff-\plusone\relax
\mondiff\lastmonth\relax
\advance\mondiff-\monstt\relax
\advance\mondiff+\monend\relax
\advance\mondiff-\plusone\relax
\ifnum\mondiff>\lastmonth
	\advance\mondiff-\lastmonth\relax
	\advance\yerdiff\plusone\relax
\fi
\getdayspermonth\yerstt\monstt
\daydiff\numberofdays\relax
\advance\daydiff-\daystt\relax
\advance\daydiff+\dayend\relax
\ifnum\mondiff=\lastmonth
	\advance\mondiff-\lastmonth\relax
	\advance\yerdiff\plusone\relax
\fi
}

\protect

\starttext

\setupstt[d={28},m={1},y={1988}]
\setupend[d={30},m={2},y={2018}]
%\setupend[\currentdate{day,month,year}]

\calculate

Pero, a lo bien, tengo \the\yerdiff\ años, \the\mondiff\ meses y \the\daydiff\ días.

\stoptext
